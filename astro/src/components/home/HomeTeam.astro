---
import UnderlinedHeader from "../UnderlinedHeader.astro";
import PrimaryButton from "../PrimaryButton.astro";
import ScrollCrop from "../ScrollCrop.astro";
import personalPlan from "/public/Personal-Plan-img.webp";
import hooman from "/public/team/hooman.webp";
import angus from "/public/team/angus.png.webp";
import rin from "/public/team/rin(2).png";
import roberto from "/public/team/rob-3.png";
import emma from "/public/team/random2.jpg.webp";
import hailey from "/public/team/hailey.png";
import salome from "/public/team/salome.png";

// Row 1: Dr Hooman, Dr Rin, Dr Angus
const doctors = [
    {
        name: "Dr Hooman Zahedi",
        image: hooman.src,
        description: "Chiropractor"
    },
    {
        name: "Dr Rin Choi",
        image: rin.src,
        description: "Chiropractor"
    },
    {
        name: "Dr Angus Phelps",
        image: angus.src,
        description: "Chiropractor"
    },
]

// Row 2: Emma, Salome, Hailey
const staff = [
    {
        name: "Emma Muir",
        image: emma.src,
        description: "Chiropractic Assistant"
    },
    {
        name: "Salome Raut",
        image: salome.src,
        description: "Chiropractic Assistant"
    },
    {
        name: "Hailey Cerneaz",
        image: hailey.src,
        description: "Chiropractic Assistant"
    },
]

// Row 3: Roberto
const therapist = {
    name: "Roberto Vita",
    image: roberto.src,
    description: "Massage Therapist"
}

---
<div class="w-full py-20">
    <div class="mx-auto container">
        <div class="text-center mb-16">
            <UnderlinedHeader>
                Meet Your Sydney CBD Chiropractors
            </UnderlinedHeader>
        </div>

        <!-- Row 1: Doctors (Dr Hooman, Dr Rin, Dr Angus) - Desktop -->
        <div class="hidden md:grid grid-cols-3 gap-8 mb-12 max-w-4xl mx-auto">
            {doctors.map((doctor) => (
                <div class="flex flex-col items-center">
                    <div class="w-40 h-40 md:w-52 md:h-52 mb-4 overflow-hidden rounded-full">
                        <img 
                            src={doctor.image} 
                            alt={doctor.name} 
                            class={`w-full h-full object-cover`}

                        />
                    </div>
                    <h3 class="text-xl font-semibold mb-1 text-custom-purple">{doctor.name}</h3>
                    <p class="text-gray-600">{doctor.description}</p>
                </div>
            ))}
        </div>

        <!-- Row 1: Doctors - Mobile -->
        <div class="grid md:hidden grid-cols-1 gap-8 mb-12">
            {doctors.map((doctor) => (
                <div class="flex flex-col items-center">
                    <div class="w-48 h-48 mb-4 overflow-hidden rounded-full">
                        <img 
                            src={doctor.image} 
                            alt={doctor.name} 
                            class={`w-full h-full  ${doctor.name === 'Dr Rin Choi' ? 'object-contain' : 'object-cover'}`}
                        />
                    </div>
                    <h3 class="text-xl font-semibold mb-1 text-custom-purple">{doctor.name}</h3>
                    <p class="text-gray-600">{doctor.description}</p>
                </div>
            ))}
        </div>

        <!-- Row 2: Staff (Emma, Salome, Hailey) - Desktop -->
        <div class="hidden md:grid grid-cols-3 gap-8 mb-12 max-w-4xl mx-auto">
            {staff.map((person) => (
                <div class="flex flex-col items-center">
                    <div class="w-40 h-40 md:w-52 md:h-52 mb-4 overflow-hidden rounded-full">
                        <img src={person.image} alt={person.name} class="w-full h-full object-cover" />
                    </div>
                    <h3 class="text-xl font-semibold mb-1 text-custom-purple">{person.name}</h3>
                    <p class="text-gray-600">{person.description}</p>
                </div>
            ))}
        </div>

        <!-- Row 2: Staff - Mobile -->
        <div class="grid md:hidden grid-cols-1 gap-8 mb-12">
            {staff.map((person) => (
                <div class="flex flex-col items-center">
                    <div class="w-48 h-48 mb-4 overflow-hidden rounded-full">
                        <img src={person.image} alt={person.name} class="w-full h-full object-cover" />
                    </div>
                    <h3 class="text-xl font-semibold mb-1 text-custom-purple">{person.name}</h3>
                    <p class="text-gray-600">{person.description}</p>
                </div>
            ))}
        </div>

        <!-- Row 3: Roberto (centered) -->
        <div class="flex justify-center">
            <div class="flex flex-col items-center">
                <div class="w-40 h-40 md:w-52 md:h-52 mb-4 overflow-hidden rounded-full">
                    <img src={therapist.image} alt={therapist.name} class="w-full h-full object-cover object-top" />
                </div>
                <h3 class="text-xl font-semibold mb-1 text-custom-purple">{therapist.name}</h3>
                <p class="text-gray-600">{therapist.description}</p>
            </div>
        </div>

        <div class="flex justify-center mt-10">
            <PrimaryButton href="https://clinic27intake.bookings.pracsuite.com/guest?_gl=1*ish5tk*_gcl_au*MTE4MzYwMjQ1Ny4xNzUyNDc4Mzk3*_ga*MTgyODUzMzI5Ni4xNzUyNDc4Mzk3*_ga_DVEN4QQTPM*czE3NTI0NzgzOTckbzEkZzAkdDE3NTI0NzgzOTckajYwJGwwJGgw*_ga_S36TR91H9N*czE3NTI0NzgzOTckbzEkZzAkdDE3NTI0NzgzOTckajYwJGwwJGgw*_ga_NTMX2EEDN4*czE3NTI0NzgzOTckbzEkZzAkdDE3NTI0NzgzOTckajYwJGwwJGgw*_ga_8J9DNH249S*czE3NTI0NzgzOTckbzEkZzAkdDE3NTI0NzgzOTckajYwJGwwJGgw" trackingEvent="book_appointment_clicked">Book Now</PrimaryButton>
        </div>
    </div>
    
    <!-- Doctor Carousel Section -->
    <div class="mt-20 relative overflow-hidden min-h-[50vh]">
        <!-- Background layer: ScrollCrop -->
        <div class="absolute inset-0 z-0">
            <ScrollCrop src={personalPlan.src} height="100%" class="w-full h-full" alt="Personal chiropractic care plan at Clinic 27 Sydney CBD" />
        </div>

        <!-- Content layer: Carousel -->
        <div class="relative z-10 py-16">
            <!-- Carousel slides -->
            <div class="carousel-content">
                {doctors.map((doctor, index) => (
                    <div class="carousel-slide" id={`slide-${index}`} style={index === 0 ? "display: block;" : "display: none;"}>
                        <div class="flex flex-col items-center px-8">
                            <div class="w-52 h-52 mb-4 overflow-hidden rounded-full">
                                <img 
                                    src={doctor.image} 
                                    alt={doctor.name} 
                                    class={`w-full h-full object-cover ${doctor.name === 'Dr Rin Choi' ? 'object-top' : ''}`}
                                />
                            </div>
                            <h3 class="text-xl font-semibold mb-1 text-white">{doctor.name}</h3>
                            <p class="text-white mb-6" style="text-transform: uppercase;">{doctor.description}</p>
                            <PrimaryButton variant="primary" href="/our-team/">Learn More About Our Team</PrimaryButton>
                        </div>
                    </div>
                ))}
            </div>
            
            <!-- Carousel navigation dots -->
            <div class="carousel-dots flex justify-center mt-8 space-x-3" role="tablist" aria-label="Doctor team carousel">
                {doctors.map((_, index) => (
                    <button 
                        class="carousel-dot w-4 h-4 rounded-full bg-gray-300 focus:outline-none p-2 touch-manipulation" 
                        data-slide={index}
                        aria-label={`Go to slide ${index + 1} - ${doctors[index].name}`}
                        aria-selected={index === 0 ? 'true' : 'false'}
                        role="tab"
                        data-index={index}
                        id={`dot-${index}`}
                    ></button>
                ))}
            </div>
        </div>
    </div>
</div>

<script>
    // Carousel functionality
    document.addEventListener('DOMContentLoaded', () => {
        const slides = document.querySelectorAll('.carousel-slide');
        const dots = document.querySelectorAll('.carousel-dot');
        
        // Set first slide and dot as active
        if (slides.length > 0) {
            (slides[0] as HTMLElement).style.display = 'block';
            dots[0].classList.add('bg-black');
        }
        
        // Add click event to dots
        dots.forEach((dot) => {
            dot.addEventListener('click', (e) => {
                const target = e.currentTarget as HTMLElement;
                const index = parseInt(target.getAttribute('data-index') || '0', 10);
                showSlide(index);
            }, { passive: true });
        });
        
        // Function to show a specific slide
        function showSlide(index: number) {
            slides.forEach((slide) => {
                (slide as HTMLElement).style.display = 'none';
            });
            
            dots.forEach(dot => {
                dot.classList.remove('bg-black');
                dot.classList.add('bg-gray-300');
            });
            
            (slides[index] as HTMLElement).style.display = 'block';
            dots[index].classList.remove('bg-gray-300');
            dots[index].classList.add('bg-black');
        }
    });
</script>
